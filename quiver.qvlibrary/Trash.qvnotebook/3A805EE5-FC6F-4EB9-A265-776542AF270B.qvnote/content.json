{
  "title": "相似图片搜索的原理",
  "cells": [
    {
      "type": "text",
      "data": "<div class=\"asset-content entry-content\" id=\"main-content\" style=\"margin: 0px; padding: 0px; list-style-type: none; border: none; letter-spacing: -0.12px; line-height: 21.6px; widows: 1; word-spacing: 2.4px;\"><p style=\"margin: 1em 0px 0px 0.8em; padding: 0px; list-style-type: none; border: none; line-height: 28.8px;\"><font color=\"#000000\" face=\"Georgia\">上个月，Google把<a href=\"http://www.google.com/insidesearch/searchbyimage.html\" target=\"_blank\" style=\"margin: 0px; padding: 0px; list-style-type: none; border: none;\">\"相似图片搜索\"</a>正式放上了首页。</font></p><p style=\"margin: 1em 0px 0px 0.8em; padding: 0px; list-style-type: none; border: none; line-height: 28.8px;\"><font color=\"#000000\" face=\"Georgia\">你可以用一张图片，搜索互联网上所有与它相似的图片。点击<a href=\"http://images.google.com.hk/\" target=\"_blank\" style=\"margin: 0px; padding: 0px; list-style-type: none; border: none;\">搜索框</a>中照相机的图标。</font></p><p style=\"margin: 1em 0px 0px 0.8em; padding: 0px; list-style-type: none; border: none; line-height: 28.8px;\"><a href=\"http://images.google.com.hk/\" target=\"_blank\" style=\"margin: 0px; padding: 0px; list-style-type: none; border: none;\"><font color=\"#000000\" face=\"Georgia\"><img src=\"quiver-image-url/D847BF33FFDF98FB5E289435FB5AD131.png\" style=\"margin: 0px; padding: 0px; list-style-type: none; text-decoration: none; border: 0.3em solid rgb(224, 223, 204); border-top-left-radius: 1em; border-top-right-radius: 1em; border-bottom-right-radius: 1em; border-bottom-left-radius: 1em;\"></font></a></p><p style=\"margin: 1em 0px 0px 0.8em; padding: 0px; list-style-type: none; border: none; line-height: 28.8px;\"><font color=\"#000000\" face=\"Georgia\">一个对话框会出现。</font></p><p style=\"margin: 1em 0px 0px 0.8em; padding: 0px; list-style-type: none; border: none; line-height: 28.8px;\"><font color=\"#000000\" face=\"Georgia\"><img src=\"quiver-image-url/6EAF3AFDB553180FCFD3B948D54B722F.png\" style=\"margin: 0px; padding: 0px; list-style-type: none; border: 0.3em solid rgb(224, 223, 204); border-top-left-radius: 1em; border-top-right-radius: 1em; border-bottom-right-radius: 1em; border-bottom-left-radius: 1em;\"></font></p><p style=\"margin: 1em 0px 0px 0.8em; padding: 0px; list-style-type: none; border: none; line-height: 28.8px;\"><font color=\"#000000\" face=\"Georgia\">你输入网片的网址，或者直接上传图片，Google就会找出与其相似的图片。下面这张图片是美国女演员Alyson Hannigan。</font></p><p style=\"margin: 1em 0px 0px 0.8em; padding: 0px; list-style-type: none; border: none; line-height: 28.8px;\"><font color=\"#000000\" face=\"Georgia\"><img src=\"quiver-image-url/C5C07BD19D6A01DEF7A8920A805B5376.jpg\" style=\"margin: 0px; padding: 0px; list-style-type: none; border: 0.3em solid rgb(224, 223, 204); border-top-left-radius: 1em; border-top-right-radius: 1em; border-bottom-right-radius: 1em; border-bottom-left-radius: 1em;\"></font></p><p style=\"margin: 1em 0px 0px 0.8em; padding: 0px; list-style-type: none; border: none; line-height: 28.8px;\"><font color=\"#000000\" face=\"Georgia\">上传后，Google返回如下结果：</font></p><p style=\"margin: 1em 0px 0px 0.8em; padding: 0px; list-style-type: none; border: none; line-height: 28.8px;\"><font color=\"#000000\" face=\"Georgia\"><img src=\"quiver-image-url/FEC02551342F0B0D31E855D9F222B98A.jpg\" style=\"margin: 0px; padding: 0px; list-style-type: none; border: 0.3em solid rgb(224, 223, 204); border-top-left-radius: 1em; border-top-right-radius: 1em; border-bottom-right-radius: 1em; border-bottom-left-radius: 1em;\"></font></p><p style=\"margin: 1em 0px 0px 0.8em; padding: 0px; list-style-type: none; border: none; line-height: 28.8px;\"><font color=\"#000000\" face=\"Georgia\">类似的\"相似图片搜索引擎\"还有不少，<a href=\"http://www.tineye.com/\" target=\"_blank\" style=\"margin: 0px; padding: 0px; list-style-type: none; border: none;\">TinEye</a>甚至可以找出照片的拍摄背景。</font></p><p style=\"margin: 1em 0px 0px 0.8em; padding: 0px; list-style-type: none; border: none; line-height: 28.8px;\"><font color=\"#000000\" face=\"Georgia\"><img src=\"quiver-image-url/B53EBB0ED2851BB881A81F3E9D8C9958.jpg\" style=\"margin: 0px; padding: 0px; list-style-type: none; border: 0.3em solid rgb(224, 223, 204); border-top-left-radius: 1em; border-top-right-radius: 1em; border-bottom-right-radius: 1em; border-bottom-left-radius: 1em;\"></font></p><p style=\"margin: 1em 0px 0px 0.8em; padding: 0px; list-style-type: none; border: none; line-height: 28.8px;\"><font color=\"#000000\" face=\"Georgia\">==========================================================</font></p><p style=\"margin: 1em 0px 0px 0.8em; padding: 0px; list-style-type: none; border: none; line-height: 28.8px;\"><font color=\"#000000\" face=\"Georgia\">这种技术的原理是什么？计算机怎么知道两张图片相似呢？</font></p><p style=\"margin: 1em 0px 0px 0.8em; padding: 0px; list-style-type: none; border: none; line-height: 28.8px;\"><font color=\"#000000\" face=\"Georgia\">根据<a href=\"http://www.hackerfactor.com/blog/index.php?/archives/432-Looks-Like-It.html\" target=\"_blank\" style=\"margin: 0px; padding: 0px; list-style-type: none; border: none;\">Neal Krawetz</a>博士的解释，原理非常简单易懂。我们可以用一个快速算法，就达到基本的效果。</font></p><p style=\"margin: 1em 0px 0px 0.8em; padding: 0px; list-style-type: none; border: none; line-height: 28.8px;\"><font color=\"#000000\" face=\"Georgia\">这里的关键技术叫做\"感知哈希算法\"（Perceptual hash algorithm），它的作用是对每张图片生成一个\"指纹\"（fingerprint）字符串，然后比较不同图片的指纹。结果越接近，就说明图片越相似。</font></p><p style=\"margin: 1em 0px 0px 0.8em; padding: 0px; list-style-type: none; border: none; line-height: 28.8px;\"><font color=\"#000000\" face=\"Georgia\">下面是一个最简单的实现：</font></p><p style=\"margin: 1em 0px 0px 0.8em; padding: 0px; list-style-type: none; border: none; line-height: 28.8px;\"><font color=\"#000000\" face=\"Georgia\">第一步，缩小尺寸。</font></p><p style=\"margin: 1em 0px 0px 0.8em; padding: 0px; list-style-type: none; border: none; line-height: 28.8px;\"><font color=\"#000000\" face=\"Georgia\">将图片缩小到8x8的尺寸，总共64个像素。这一步的作用是去除图片的细节，只保留结构、明暗等基本信息，摒弃不同尺寸、比例带来的图片差异。</font></p><p style=\"margin: 1em 0px 0px 0.8em; padding: 0px; list-style-type: none; border: none; line-height: 28.8px;\"><font color=\"#000000\" face=\"Georgia\"><img src=\"quiver-image-url/915FB2CA7373490FB7EFC71FBA425C4B.png\" style=\"margin: 0px; padding: 0px; list-style-type: none; border: 0.3em solid rgb(224, 223, 204); border-top-left-radius: 1em; border-top-right-radius: 1em; border-bottom-right-radius: 1em; border-bottom-left-radius: 1em;\">&nbsp;<img src=\"quiver-image-url/915FB2CA7373490FB7EFC71FBA425C4B.png\" width=\"64\" height=\"64\" style=\"margin: 0px; padding: 0px; list-style-type: none; border: 0.3em solid rgb(224, 223, 204); border-top-left-radius: 1em; border-top-right-radius: 1em; border-bottom-right-radius: 1em; border-bottom-left-radius: 1em;\"></font></p><p style=\"margin: 1em 0px 0px 0.8em; padding: 0px; list-style-type: none; border: none; line-height: 28.8px;\"><font color=\"#000000\" face=\"Georgia\">第二步，简化色彩。</font></p><p style=\"margin: 1em 0px 0px 0.8em; padding: 0px; list-style-type: none; border: none; line-height: 28.8px;\"><font color=\"#000000\" face=\"Georgia\">将缩小后的图片，转为64级灰度。也就是说，所有像素点总共只有64种颜色。</font></p><p style=\"margin: 1em 0px 0px 0.8em; padding: 0px; list-style-type: none; border: none; line-height: 28.8px;\"><font color=\"#000000\" face=\"Georgia\">第三步，计算平均值。</font></p><p style=\"margin: 1em 0px 0px 0.8em; padding: 0px; list-style-type: none; border: none; line-height: 28.8px;\"><font color=\"#000000\" face=\"Georgia\">计算所有64个像素的灰度平均值。</font></p><p style=\"margin: 1em 0px 0px 0.8em; padding: 0px; list-style-type: none; border: none; line-height: 28.8px;\"><font color=\"#000000\" face=\"Georgia\">第四步，比较像素的灰度。</font></p><p style=\"margin: 1em 0px 0px 0.8em; padding: 0px; list-style-type: none; border: none; line-height: 28.8px;\"><font color=\"#000000\" face=\"Georgia\">将每个像素的灰度，与平均值进行比较。大于或等于平均值，记为1；小于平均值，记为0。</font></p><p style=\"margin: 1em 0px 0px 0.8em; padding: 0px; list-style-type: none; border: none; line-height: 28.8px;\"><font color=\"#000000\" face=\"Georgia\">第五步，计算哈希值。</font></p><p style=\"margin: 1em 0px 0px 0.8em; padding: 0px; list-style-type: none; border: none; line-height: 28.8px;\"><font color=\"#000000\" face=\"Georgia\">将上一步的比较结果，组合在一起，就构成了一个64位的整数，这就是这张图片的指纹。组合的次序并不重要，只要保证所有图片都采用同样次序就行了。</font></p><p style=\"margin: 1em 0px 0px 0.8em; padding: 0px; list-style-type: none; border: none; line-height: 28.8px;\"><font color=\"#000000\" face=\"Georgia\"><img src=\"quiver-image-url/C7E3DF34320049A1B2D411B0AF8AA1E1.png\" style=\"margin: 0px; padding: 0px; list-style-type: none; border: 0.3em solid rgb(224, 223, 204); border-top-left-radius: 1em; border-top-right-radius: 1em; border-bottom-right-radius: 1em; border-bottom-left-radius: 1em;\">&nbsp;=&nbsp;<img src=\"quiver-image-url/C7E3DF34320049A1B2D411B0AF8AA1E1.png\" width=\"64\" height=\"64\" style=\"margin: 0px; padding: 0px; list-style-type: none; border: 0.3em solid rgb(224, 223, 204); border-top-left-radius: 1em; border-top-right-radius: 1em; border-bottom-right-radius: 1em; border-bottom-left-radius: 1em;\">&nbsp;= 8f373714acfcf4d0</font></p><p style=\"margin: 1em 0px 0px 0.8em; padding: 0px; list-style-type: none; border: none; line-height: 28.8px;\"><font color=\"#000000\" face=\"Georgia\">得到指纹以后，就可以对比不同的图片，看看64位中有多少位是不一样的。在理论上，这等同于计算<a href=\"http://zh.wikipedia.org/wiki/%E6%B1%89%E6%98%8E%E8%B7%9D%E7%A6%BB\" target=\"_blank\" style=\"margin: 0px; padding: 0px; list-style-type: none; border: none;\">\"汉明距离\"</a>（Hamming distance）。如果不相同的数据位不超过5，就说明两张图片很相似；如果大于10，就说明这是两张不同的图片。</font></p><p style=\"margin: 1em 0px 0px 0.8em; padding: 0px; list-style-type: none; border: none; line-height: 28.8px;\"><font color=\"#000000\" face=\"Georgia\">具体的代码实现，可以参见<a href=\"http://www.reddit.com/r/programming/comments/hql8b/looks_like_it_for_the_last_few_months_i_have_had/c1xkcdd\" target=\"_blank\" style=\"margin: 0px; padding: 0px; list-style-type: none; border: none;\">Wote</a>用python语言写的<a href=\"http://www.ruanyifeng.com/blog/2011/07/imgHash.txt\" target=\"_blank\" style=\"margin: 0px; padding: 0px; list-style-type: none; border: none;\">imgHash.py</a>。代码很短，只有53行。使用的时候，第一个参数是基准图片，第二个参数是用来比较的其他图片所在的目录，返回结果是两张图片之间不相同的数据位数量（汉明距离）。</font></p><p style=\"margin: 1em 0px 0px 0.8em; padding: 0px; list-style-type: none; border: none; line-height: 28.8px;\"><font color=\"#000000\" face=\"Georgia\">这种算法的优点是简单快速，不受图片大小缩放的影响，缺点是图片的内容不能变更。如果在图片上加几个文字，它就认不出来了。所以，它的最佳用途是根据缩略图，找出原图。</font></p><p style=\"margin: 1em 0px 0px 0.8em; padding: 0px; list-style-type: none; border: none; line-height: 28.8px;\"><font color=\"#000000\" face=\"Georgia\">实际应用中，往往采用更强大的<a href=\"http://www.phash.org/\" target=\"_blank\" style=\"margin: 0px; padding: 0px; list-style-type: none; border: none;\">pHash</a>算法和<a href=\"http://en.wikipedia.org/wiki/Scale-invariant_feature_transform\" target=\"_blank\" style=\"margin: 0px; padding: 0px; list-style-type: none; border: none;\">SIFT</a>算法，它们能够识别图片的变形。只要变形程度不超过25%，它们就能匹配原图。这些算法虽然更复杂，但是原理与上面的简便算法是一样的，就是先将图片转化成Hash字符串，然后再进行比较。</font></p><p style=\"margin: 1em 0px 0px 0.8em; padding: 0px; list-style-type: none; border: none; line-height: 28.8px;\"><font color=\"#000000\" face=\"Georgia\">UPDATE（2013.03.31）</font></p><p style=\"margin: 1em 0px 0px 0.8em; padding: 0px; list-style-type: none; border: none; line-height: 28.8px;\"><font color=\"#000000\" face=\"Georgia\">这篇文章还有续集，请看<a href=\"http://www.ruanyifeng.com/blog/2013/03/similar_image_search_part_ii.html\" target=\"_blank\" style=\"margin: 0px; padding: 0px; list-style-type: none; border: none;\">这里</a>。</font></p></div>"
    }
  ]
}