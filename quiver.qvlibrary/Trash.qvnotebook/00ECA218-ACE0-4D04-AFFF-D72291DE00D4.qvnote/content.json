{
  "title": "Mysql备份",
  "cells": [
    {
      "type": "text",
      "data": "<div style=\"box-sizing: border-box; margin: 0cm 0cm 0pt; padding: 0px; color: rgb(85, 85, 85); font-family: 宋体, 'Arial Narrow', arial, serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2;\"><span style=\"box-sizing: border-box; padding: 0px; margin: 0px; font-size: 14pt; font-family: 楷体_gb2312;\">一、主从同步</span></div><div style=\"box-sizing: border-box; margin: 0cm 0cm 0pt; padding: 0px; color: rgb(85, 85, 85); font-family: 宋体, 'Arial Narrow', arial, serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2;\"><span style=\"box-sizing: border-box; padding: 0px; margin: 0px; font-size: 14pt; font-family: 楷体_gb2312;\">可以参考<span style=\"box-sizing: border-box; padding: 0px; margin: 0px;\">http://kerry.blog.51cto.com/172631/110206</span></span></div><div style=\"box-sizing: border-box; margin: 0cm 0cm 0pt; padding: 0px; color: rgb(85, 85, 85); font-family: 宋体, 'Arial Narrow', arial, serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2;\"><span style=\"box-sizing: border-box; padding: 0px; margin: 0px; font-size: 14pt; font-family: 楷体_gb2312;\">二、增量备份：</span></div><div style=\"box-sizing: border-box; margin: 0cm 0cm 0pt; padding: 0px; color: rgb(85, 85, 85); font-family: 宋体, 'Arial Narrow', arial, serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2; text-indent: 35pt;\"><span style=\"box-sizing: border-box; padding: 0px; margin: 0px; font-size: 14pt; font-family: 楷体_gb2312;\">每天中午<span style=\"box-sizing: border-box; padding: 0px; margin: 0px;\">12</span>点和晚上<span style=\"box-sizing: border-box; padding: 0px; margin: 0px;\">12</span>点做一次全备，每隔一小时备份<span style=\"box-sizing: border-box; padding: 0px; margin: 0px;\">binlog,</span>也就是增量备份，具体操作如下：</span></div><div style=\"box-sizing: border-box; margin: 0cm 0cm 0pt; padding: 0px; color: rgb(85, 85, 85); font-family: 宋体, 'Arial Narrow', arial, serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2;\"><span style=\"box-sizing: border-box; padding: 0px; margin: 0px; font-size: 14pt; font-family: 楷体_gb2312;\">Linux</span><span style=\"box-sizing: border-box; padding: 0px; margin: 0px; font-size: 14pt; font-family: 楷体_gb2312;\">下开启<span style=\"box-sizing: border-box; padding: 0px; margin: 0px;\">binlog</span></span></div><div style=\"box-sizing: border-box; margin: 0cm 0cm 0pt; padding: 0px; color: rgb(85, 85, 85); font-family: 宋体, 'Arial Narrow', arial, serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2;\"><span style=\"box-sizing: border-box; padding: 0px; margin: 0px; font-size: 14pt; font-family: 楷体_gb2312;\">/etc/my.cnf</span><span style=\"box-sizing: border-box; padding: 0px; margin: 0px; font-size: 14pt; font-family: 楷体_gb2312;\">中的<span style=\"box-sizing: border-box; padding: 0px; margin: 0px;\">mysqld</span>部分加入<span style=\"box-sizing: border-box; padding: 0px; margin: 0px;\">:</span></span></div><div style=\"box-sizing: border-box; margin: 0cm 0cm 0pt; padding: 0px; color: rgb(85, 85, 85); font-family: 宋体, 'Arial Narrow', arial, serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2;\"><span style=\"box-sizing: border-box; padding: 0px; margin: 0px; font-size: 14pt; font-family: 楷体_gb2312;\">[mysqld]</span></div><div style=\"box-sizing: border-box; margin: 0cm 0cm 0pt; padding: 0px; color: rgb(85, 85, 85); font-family: 宋体, 'Arial Narrow', arial, serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2;\"><span style=\"box-sizing: border-box; padding: 0px; margin: 0px; font-size: 14pt; font-family: 楷体_gb2312;\">log-bin=../logs/mysql-bin</span></div><div style=\"box-sizing: border-box; margin: 0cm 0cm 0pt; padding: 0px; color: rgb(85, 85, 85); font-family: 宋体, 'Arial Narrow', arial, serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2;\"><span style=\"box-sizing: border-box; padding: 0px; margin: 0px; font-size: 14pt; font-family: 楷体_gb2312;\">max-binlog-size=50M</span></div><div style=\"box-sizing: border-box; margin: 0cm 0cm 0pt; padding: 0px; color: rgb(85, 85, 85); font-family: 宋体, 'Arial Narrow', arial, serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2;\"><span style=\"box-sizing: border-box; padding: 0px; margin: 0px; font-size: 14pt; font-family: 楷体_gb2312;\">&nbsp;</span></div><div style=\"box-sizing: border-box; margin: 0cm 0cm 0pt; padding: 0px; color: rgb(85, 85, 85); font-family: 宋体, 'Arial Narrow', arial, serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2;\"><span style=\"box-sizing: border-box; padding: 0px; margin: 0px; font-size: 14pt; font-family: 楷体_gb2312;\">windows</span><span style=\"box-sizing: border-box; padding: 0px; margin: 0px; font-size: 14pt; font-family: 楷体_gb2312;\">下开启<span style=\"box-sizing: border-box; padding: 0px; margin: 0px;\">binlog</span></span></div><div style=\"box-sizing: border-box; margin: 0cm 0cm 0pt; padding: 0px; color: rgb(85, 85, 85); font-family: 宋体, 'Arial Narrow', arial, serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2;\"><span style=\"box-sizing: border-box; padding: 0px; margin: 0px; font-size: 14pt; font-family: 楷体_gb2312;\">%mysql%/my.ini</span><span style=\"box-sizing: border-box; padding: 0px; margin: 0px; font-size: 14pt; font-family: 楷体_gb2312;\">中的<span style=\"box-sizing: border-box; padding: 0px; margin: 0px;\">mysqld</span>部分加入<span style=\"box-sizing: border-box; padding: 0px; margin: 0px;\">:</span></span></div><div style=\"box-sizing: border-box; margin: 0cm 0cm 0pt; padding: 0px; color: rgb(85, 85, 85); font-family: 宋体, 'Arial Narrow', arial, serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2;\"><span style=\"box-sizing: border-box; padding: 0px; margin: 0px; font-size: 14pt; font-family: 楷体_gb2312;\">[mysqld]</span></div><div style=\"box-sizing: border-box; margin: 0cm 0cm 0pt; padding: 0px; color: rgb(85, 85, 85); font-family: 宋体, 'Arial Narrow', arial, serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2;\"><span style=\"box-sizing: border-box; padding: 0px; margin: 0px; font-size: 14pt; font-family: 楷体_gb2312;\">log-bin =../logs/mysql-bin</span></div><div style=\"box-sizing: border-box; margin: 0cm 0cm 0pt; padding: 0px; color: rgb(85, 85, 85); font-family: 宋体, 'Arial Narrow', arial, serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2;\"><span style=\"box-sizing: border-box; padding: 0px; margin: 0px; font-size: 14pt; font-family: 楷体_gb2312;\">max-binlog-size=50M</span></div><div style=\"box-sizing: border-box; margin: 0cm 0cm 0pt; padding: 0px; color: rgb(85, 85, 85); font-family: 宋体, 'Arial Narrow', arial, serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2;\"><span style=\"box-sizing: border-box; padding: 0px; margin: 0px; font-size: 14pt; font-family: 楷体_gb2312;\">&nbsp;</span></div><div style=\"box-sizing: border-box; margin: 0cm 0cm 0pt; padding: 0px; color: rgb(85, 85, 85); font-family: 宋体, 'Arial Narrow', arial, serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2;\"><span style=\"box-sizing: border-box; padding: 0px; margin: 0px; font-size: 14pt; font-family: 楷体_gb2312;\">完整备份脚本 （网友提供）</span></div><div style=\"box-sizing: border-box; margin: 0cm 0cm 0pt; padding: 0px; color: rgb(85, 85, 85); font-family: 宋体, 'Arial Narrow', arial, serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2;\"><span style=\"box-sizing: border-box; padding: 0px; margin: 0px; font-size: 14pt; font-family: 楷体_gb2312;\">如果数据库数据量比较大，可以一天全备一次<span style=\"box-sizing: border-box; padding: 0px; margin: 0px;\">,&nbsp;</span>再每隔一小时增量备份一次；</span></div><div style=\"box-sizing: border-box; margin: 0cm 0cm 0pt; padding: 0px; color: rgb(85, 85, 85); font-family: 宋体, 'Arial Narrow', arial, serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2;\"><span style=\"box-sizing: border-box; padding: 0px; margin: 0px; font-size: 14pt; font-family: 楷体_gb2312;\">#!/bin/sh</span></div><div style=\"box-sizing: border-box; margin: 0cm 0cm 0pt; padding: 0px; color: rgb(85, 85, 85); font-family: 宋体, 'Arial Narrow', arial, serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2;\"><span style=\"box-sizing: border-box; padding: 0px; margin: 0px; font-size: 14pt; font-family: 楷体_gb2312;\"># mysql data backup script #</span></div><div style=\"box-sizing: border-box; margin: 0cm 0cm 0pt; padding: 0px; color: rgb(85, 85, 85); font-family: 宋体, 'Arial Narrow', arial, serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2;\"><span style=\"box-sizing: border-box; padding: 0px; margin: 0px; font-size: 14pt; font-family: 楷体_gb2312;\"># use mysqldump --help,get more detail.</span></div><div style=\"box-sizing: border-box; margin: 0cm 0cm 0pt; padding: 0px; color: rgb(85, 85, 85); font-family: 宋体, 'Arial Narrow', arial, serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2;\"><span style=\"box-sizing: border-box; padding: 0px; margin: 0px; font-size: 14pt; font-family: 楷体_gb2312;\">BakDir=/backup/mysql</span></div><div style=\"box-sizing: border-box; margin: 0cm 0cm 0pt; padding: 0px; color: rgb(85, 85, 85); font-family: 宋体, 'Arial Narrow', arial, serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2;\"><span style=\"box-sizing: border-box; padding: 0px; margin: 0px; font-size: 14pt; font-family: 楷体_gb2312;\">LogFile=/backup/mysql/mysqlbak.log</span></div><div style=\"box-sizing: border-box; margin: 0cm 0cm 0pt; padding: 0px; color: rgb(85, 85, 85); font-family: 宋体, 'Arial Narrow', arial, serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2;\"><span style=\"box-sizing: border-box; padding: 0px; margin: 0px; font-size: 14pt; font-family: 楷体_gb2312;\">DATE=`date +%Y%m%d`</span></div><div style=\"box-sizing: border-box; margin: 0cm 0cm 0pt; padding: 0px; color: rgb(85, 85, 85); font-family: 宋体, 'Arial Narrow', arial, serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2;\"><span style=\"box-sizing: border-box; padding: 0px; margin: 0px; font-size: 14pt; font-family: 楷体_gb2312;\">echo \" \" &gt;&gt; $LogFile</span></div><div style=\"box-sizing: border-box; margin: 0cm 0cm 0pt; padding: 0px; color: rgb(85, 85, 85); font-family: 宋体, 'Arial Narrow', arial, serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2;\"><span style=\"box-sizing: border-box; padding: 0px; margin: 0px; font-size: 14pt; font-family: 楷体_gb2312;\">echo \" \" &gt;&gt; $LogFile</span></div><div style=\"box-sizing: border-box; margin: 0cm 0cm 0pt; padding: 0px; color: rgb(85, 85, 85); font-family: 宋体, 'Arial Narrow', arial, serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2;\"><span style=\"box-sizing: border-box; padding: 0px; margin: 0px; font-size: 14pt; font-family: 楷体_gb2312;\">echo \"-------------------------------------------\" &gt;&gt; $LogFile</span></div><div style=\"box-sizing: border-box; margin: 0cm 0cm 0pt; padding: 0px; color: rgb(85, 85, 85); font-family: 宋体, 'Arial Narrow', arial, serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2;\"><span style=\"box-sizing: border-box; padding: 0px; margin: 0px; font-size: 14pt; font-family: 楷体_gb2312;\">echo $(date +\"%y-%m-%d %H:%M:%S\") &gt;&gt; $LogFile</span></div><div style=\"box-sizing: border-box; margin: 0cm 0cm 0pt; padding: 0px; color: rgb(85, 85, 85); font-family: 宋体, 'Arial Narrow', arial, serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2;\"><span style=\"box-sizing: border-box; padding: 0px; margin: 0px; font-size: 14pt; font-family: 楷体_gb2312;\">echo \"--------------------------\" &gt;&gt; $LogFile</span></div><div style=\"box-sizing: border-box; margin: 0cm 0cm 0pt; padding: 0px; color: rgb(85, 85, 85); font-family: 宋体, 'Arial Narrow', arial, serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2;\"><span style=\"box-sizing: border-box; padding: 0px; margin: 0px; font-size: 14pt; font-family: 楷体_gb2312;\">cd $BakDir</span></div><div style=\"box-sizing: border-box; margin: 0cm 0cm 0pt; padding: 0px; color: rgb(85, 85, 85); font-family: 宋体, 'Arial Narrow', arial, serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2;\"><span style=\"box-sizing: border-box; padding: 0px; margin: 0px; font-size: 14pt; font-family: 楷体_gb2312;\">DumpFile=$DATE.sql</span></div><div style=\"box-sizing: border-box; margin: 0cm 0cm 0pt; padding: 0px; color: rgb(85, 85, 85); font-family: 宋体, 'Arial Narrow', arial, serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2;\"><span style=\"box-sizing: border-box; padding: 0px; margin: 0px; font-size: 14pt; font-family: 楷体_gb2312;\">GZDumpFile=$DATE.sql.tgz</span></div><div style=\"box-sizing: border-box; margin: 0cm 0cm 0pt; padding: 0px; color: rgb(85, 85, 85); font-family: 宋体, 'Arial Narrow', arial, serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2;\"><span style=\"box-sizing: border-box; padding: 0px; margin: 0px; font-size: 14pt; font-family: 楷体_gb2312;\">mysqldump --quick --all-databases --flush-logs</span></div><div style=\"box-sizing: border-box; margin: 0cm 0cm 0pt; padding: 0px; color: rgb(85, 85, 85); font-family: 宋体, 'Arial Narrow', arial, serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2;\"><span style=\"box-sizing: border-box; padding: 0px; margin: 0px; font-size: 14pt; font-family: 楷体_gb2312;\">--delete-master-logs --lock-all-tables</span></div><div style=\"box-sizing: border-box; margin: 0cm 0cm 0pt; padding: 0px; color: rgb(85, 85, 85); font-family: 宋体, 'Arial Narrow', arial, serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2;\"><span style=\"box-sizing: border-box; padding: 0px; margin: 0px; font-size: 14pt; font-family: 楷体_gb2312;\">&gt; $DumpFile</span></div><div style=\"box-sizing: border-box; margin: 0cm 0cm 0pt; padding: 0px; color: rgb(85, 85, 85); font-family: 宋体, 'Arial Narrow', arial, serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2;\"><span style=\"box-sizing: border-box; padding: 0px; margin: 0px; font-size: 14pt; font-family: 楷体_gb2312;\">echo \"Dump Done\" &gt;&gt; $LogFile</span></div><div style=\"box-sizing: border-box; margin: 0cm 0cm 0pt; padding: 0px; color: rgb(85, 85, 85); font-family: 宋体, 'Arial Narrow', arial, serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2;\"><span style=\"box-sizing: border-box; padding: 0px; margin: 0px; font-size: 14pt; font-family: 楷体_gb2312;\">tar czvf $GZDumpFile $DumpFile &gt;&gt; $LogFile 2&gt;&amp;1</span></div><div style=\"box-sizing: border-box; margin: 0cm 0cm 0pt; padding: 0px; color: rgb(85, 85, 85); font-family: 宋体, 'Arial Narrow', arial, serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2;\"><span style=\"box-sizing: border-box; padding: 0px; margin: 0px; font-size: 14pt; font-family: 楷体_gb2312;\">echo \"[$GZDumpFile]Backup Success!\" &gt;&gt; $LogFile</span></div><div style=\"box-sizing: border-box; margin: 0cm 0cm 0pt; padding: 0px; color: rgb(85, 85, 85); font-family: 宋体, 'Arial Narrow', arial, serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2;\"><span style=\"box-sizing: border-box; padding: 0px; margin: 0px; font-size: 14pt; font-family: 楷体_gb2312;\">rm -f $DumpFile</span></div><div style=\"box-sizing: border-box; margin: 0cm 0cm 0pt; padding: 0px; color: rgb(85, 85, 85); font-family: 宋体, 'Arial Narrow', arial, serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2;\"><span style=\"box-sizing: border-box; padding: 0px; margin: 0px; font-size: 14pt; font-family: 楷体_gb2312;\">#delete previous daily backup files:</span><span style=\"box-sizing: border-box; padding: 0px; margin: 0px; font-size: 14pt; font-family: 楷体_gb2312;\">采用增量备份的文件<span style=\"box-sizing: border-box; padding: 0px; margin: 0px;\">,</span>如果完整备份后<span style=\"box-sizing: border-box; padding: 0px; margin: 0px;\">,</span>则删除增量备份的文件<span style=\"box-sizing: border-box; padding: 0px; margin: 0px;\">.</span></span></div><div style=\"box-sizing: border-box; margin: 0cm 0cm 0pt; padding: 0px; color: rgb(85, 85, 85); font-family: 宋体, 'Arial Narrow', arial, serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2;\"><span style=\"box-sizing: border-box; padding: 0px; margin: 0px; font-size: 14pt; font-family: 楷体_gb2312;\">cd $BakDir/daily</span></div><div style=\"box-sizing: border-box; margin: 0cm 0cm 0pt; padding: 0px; color: rgb(85, 85, 85); font-family: 宋体, 'Arial Narrow', arial, serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2;\"><span style=\"box-sizing: border-box; padding: 0px; margin: 0px; font-size: 14pt; font-family: 楷体_gb2312;\">rm -f *</span></div><div style=\"box-sizing: border-box; margin: 0cm 0cm 0pt; padding: 0px; color: rgb(85, 85, 85); font-family: 宋体, 'Arial Narrow', arial, serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2;\"><span style=\"box-sizing: border-box; padding: 0px; margin: 0px; font-size: 14pt; font-family: 楷体_gb2312;\">cd $BakDir</span></div><div style=\"box-sizing: border-box; margin: 0cm 0cm 0pt; padding: 0px; color: rgb(85, 85, 85); font-family: 宋体, 'Arial Narrow', arial, serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2;\"><span style=\"box-sizing: border-box; padding: 0px; margin: 0px; font-size: 14pt; font-family: 楷体_gb2312;\">echo \"Backup Done!\"</span></div><div style=\"box-sizing: border-box; margin: 0cm 0cm 0pt; padding: 0px; color: rgb(85, 85, 85); font-family: 宋体, 'Arial Narrow', arial, serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2;\"><span style=\"box-sizing: border-box; padding: 0px; margin: 0px; font-size: 14pt; font-family: 楷体_gb2312;\">echo \"please Check $BakDir Directory!\"</span></div><div style=\"box-sizing: border-box; margin: 0cm 0cm 0pt; padding: 0px; color: rgb(85, 85, 85); font-family: 宋体, 'Arial Narrow', arial, serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2;\"><span style=\"box-sizing: border-box; padding: 0px; margin: 0px; font-size: 14pt; font-family: 楷体_gb2312;\">echo \"copy it to your local disk or ftp to somewhere !!!\"</span></div><div style=\"box-sizing: border-box; margin: 0cm 0cm 0pt; padding: 0px; color: rgb(85, 85, 85); font-family: 宋体, 'Arial Narrow', arial, serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2;\"><span style=\"box-sizing: border-box; padding: 0px; margin: 0px; font-size: 14pt; font-family: 楷体_gb2312;\">ls -al $BakDir</span></div><div style=\"box-sizing: border-box; margin: 0cm 0cm 0pt; padding: 0px; color: rgb(85, 85, 85); font-family: 宋体, 'Arial Narrow', arial, serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2;\"><span style=\"box-sizing: border-box; padding: 0px; margin: 0px; font-size: 14pt; font-family: 楷体_gb2312;\">上面的脚本把<span style=\"box-sizing: border-box; padding: 0px; margin: 0px;\">mysql</span>备份到本地的<span style=\"box-sizing: border-box; padding: 0px; margin: 0px;\">/backup/mysql</span>目录<span style=\"box-sizing: border-box; padding: 0px; margin: 0px;\">,</span>增量备份的文件放在<span style=\"box-sizing: border-box; padding: 0px; margin: 0px;\">/backup/mysql/daily</span>目录下<span style=\"box-sizing: border-box; padding: 0px; margin: 0px;\">.</span></span></div><div style=\"box-sizing: border-box; margin: 0cm 0cm 0pt; padding: 0px; color: rgb(85, 85, 85); font-family: 宋体, 'Arial Narrow', arial, serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2;\"><span style=\"box-sizing: border-box; padding: 0px; margin: 0px; font-size: 14pt; font-family: 楷体_gb2312;\">增量备份</span></div><div style=\"box-sizing: border-box; margin: 0cm 0cm 0pt; padding: 0px; color: rgb(85, 85, 85); font-family: 宋体, 'Arial Narrow', arial, serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2;\"><span style=\"box-sizing: border-box; padding: 0px; margin: 0px; font-size: 14pt; font-family: 楷体_gb2312;\">增量备份的数据量比较小<span style=\"box-sizing: border-box; padding: 0px; margin: 0px;\">,</span>但是要在完整备份的基础上操作</span></div><div style=\"box-sizing: border-box; margin: 0cm 0cm 0pt; padding: 0px; color: rgb(85, 85, 85); font-family: 宋体, 'Arial Narrow', arial, serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2;\"><span style=\"box-sizing: border-box; padding: 0px; margin: 0px; font-size: 14pt; font-family: 楷体_gb2312;\">增量备份使用<span style=\"box-sizing: border-box; padding: 0px; margin: 0px;\">bin log,</span>脚本如下<span style=\"box-sizing: border-box; padding: 0px; margin: 0px;\">:</span></span></div><div style=\"box-sizing: border-box; margin: 0cm 0cm 0pt; padding: 0px; color: rgb(85, 85, 85); font-family: 宋体, 'Arial Narrow', arial, serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2;\"><span style=\"box-sizing: border-box; padding: 0px; margin: 0px; font-size: 14pt; font-family: 楷体_gb2312;\">#!/bin/sh</span></div><div style=\"box-sizing: border-box; margin: 0cm 0cm 0pt; padding: 0px; color: rgb(85, 85, 85); font-family: 宋体, 'Arial Narrow', arial, serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2;\"><span style=\"box-sizing: border-box; padding: 0px; margin: 0px; font-size: 14pt; font-family: 楷体_gb2312;\"># mysql binlog backup script</span></div><div style=\"box-sizing: border-box; margin: 0cm 0cm 0pt; padding: 0px; color: rgb(85, 85, 85); font-family: 宋体, 'Arial Narrow', arial, serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2;\"><span style=\"box-sizing: border-box; padding: 0px; margin: 0px; font-size: 14pt; font-family: 楷体_gb2312;\">/usr/bin/mysqladmin flush-logs</span></div><div style=\"box-sizing: border-box; margin: 0cm 0cm 0pt; padding: 0px; color: rgb(85, 85, 85); font-family: 宋体, 'Arial Narrow', arial, serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2;\"><span style=\"box-sizing: border-box; padding: 0px; margin: 0px; font-size: 14pt; font-family: 楷体_gb2312;\">DATADIR=/var/lib/mysql</span></div><div style=\"box-sizing: border-box; margin: 0cm 0cm 0pt; padding: 0px; color: rgb(85, 85, 85); font-family: 宋体, 'Arial Narrow', arial, serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2;\"><span style=\"box-sizing: border-box; padding: 0px; margin: 0px; font-size: 14pt; font-family: 楷体_gb2312;\">BAKDIR=/backup/mysql/daily</span></div><div style=\"box-sizing: border-box; margin: 0cm 0cm 0pt; padding: 0px; color: rgb(85, 85, 85); font-family: 宋体, 'Arial Narrow', arial, serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2;\"><span style=\"box-sizing: border-box; padding: 0px; margin: 0px; font-size: 14pt; font-family: 楷体_gb2312;\">###</span><span style=\"box-sizing: border-box; padding: 0px; margin: 0px; font-size: 14pt; font-family: 楷体_gb2312;\">如果你做了特殊设置<span style=\"box-sizing: border-box; padding: 0px; margin: 0px;\">,</span>请修改此处或者修改应用此变量的行<span style=\"box-sizing: border-box; padding: 0px; margin: 0px;\">:</span>缺省取机器名<span style=\"box-sizing: border-box; padding: 0px; margin: 0px;\">,mysql</span>缺省也是取机器名</span></div><div style=\"box-sizing: border-box; margin: 0cm 0cm 0pt; padding: 0px; color: rgb(85, 85, 85); font-family: 宋体, 'Arial Narrow', arial, serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2;\"><span style=\"box-sizing: border-box; padding: 0px; margin: 0px; font-size: 14pt; font-family: 楷体_gb2312;\">HOSTNAME=`uname -n`</span></div><div style=\"box-sizing: border-box; margin: 0cm 0cm 0pt; padding: 0px; color: rgb(85, 85, 85); font-family: 宋体, 'Arial Narrow', arial, serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2;\"><span style=\"box-sizing: border-box; padding: 0px; margin: 0px; font-size: 14pt; font-family: 楷体_gb2312;\">cd $DATADIR</span></div><div style=\"box-sizing: border-box; margin: 0cm 0cm 0pt; padding: 0px; color: rgb(85, 85, 85); font-family: 宋体, 'Arial Narrow', arial, serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2;\"><span style=\"box-sizing: border-box; padding: 0px; margin: 0px; font-size: 14pt; font-family: 楷体_gb2312;\">FILELIST=`cat $HOSTNAME-bin.index`</span></div><div style=\"box-sizing: border-box; margin: 0cm 0cm 0pt; padding: 0px; color: rgb(85, 85, 85); font-family: 宋体, 'Arial Narrow', arial, serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2;\"><span style=\"box-sizing: border-box; padding: 0px; margin: 0px; font-size: 14pt; font-family: 楷体_gb2312;\">##</span><span style=\"box-sizing: border-box; padding: 0px; margin: 0px; font-size: 14pt; font-family: 楷体_gb2312;\">计算行数<span style=\"box-sizing: border-box; padding: 0px; margin: 0px;\">,</span>也就是文件数</span></div><div style=\"box-sizing: border-box; margin: 0cm 0cm 0pt; padding: 0px; color: rgb(85, 85, 85); font-family: 宋体, 'Arial Narrow', arial, serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2;\"><span style=\"box-sizing: border-box; padding: 0px; margin: 0px; font-size: 14pt; font-family: 楷体_gb2312;\">COUNTER=0</span></div><div style=\"box-sizing: border-box; margin: 0cm 0cm 0pt; padding: 0px; color: rgb(85, 85, 85); font-family: 宋体, 'Arial Narrow', arial, serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2;\"><span style=\"box-sizing: border-box; padding: 0px; margin: 0px; font-size: 14pt; font-family: 楷体_gb2312;\">for file in $FILELIST</span></div><div style=\"box-sizing: border-box; margin: 0cm 0cm 0pt; padding: 0px; color: rgb(85, 85, 85); font-family: 宋体, 'Arial Narrow', arial, serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2;\"><span style=\"box-sizing: border-box; padding: 0px; margin: 0px; font-size: 14pt; font-family: 楷体_gb2312;\">do</span></div><div style=\"box-sizing: border-box; margin: 0cm 0cm 0pt; padding: 0px; color: rgb(85, 85, 85); font-family: 宋体, 'Arial Narrow', arial, serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2;\"><span style=\"box-sizing: border-box; padding: 0px; margin: 0px; font-size: 14pt; font-family: 楷体_gb2312;\">COUNTER=`expr $COUNTER + 1 `</span></div><div style=\"box-sizing: border-box; margin: 0cm 0cm 0pt; padding: 0px; color: rgb(85, 85, 85); font-family: 宋体, 'Arial Narrow', arial, serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2;\"><span style=\"box-sizing: border-box; padding: 0px; margin: 0px; font-size: 14pt; font-family: 楷体_gb2312;\">done</span></div><div style=\"box-sizing: border-box; margin: 0cm 0cm 0pt; padding: 0px; color: rgb(85, 85, 85); font-family: 宋体, 'Arial Narrow', arial, serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2;\"><span style=\"box-sizing: border-box; padding: 0px; margin: 0px; font-size: 14pt; font-family: 楷体_gb2312;\">NextNum=0</span></div><div style=\"box-sizing: border-box; margin: 0cm 0cm 0pt; padding: 0px; color: rgb(85, 85, 85); font-family: 宋体, 'Arial Narrow', arial, serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2;\"><span style=\"box-sizing: border-box; padding: 0px; margin: 0px; font-size: 14pt; font-family: 楷体_gb2312;\">for file in<span style=\"box-sizing: border-box; padding: 0px; margin: 0px;\">&nbsp;&nbsp;</span>$FILELIST</span></div><div style=\"box-sizing: border-box; margin: 0cm 0cm 0pt; padding: 0px; color: rgb(85, 85, 85); font-family: 宋体, 'Arial Narrow', arial, serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2;\"><span style=\"box-sizing: border-box; padding: 0px; margin: 0px; font-size: 14pt; font-family: 楷体_gb2312;\">do</span></div><div style=\"box-sizing: border-box; margin: 0cm 0cm 0pt; padding: 0px; color: rgb(85, 85, 85); font-family: 宋体, 'Arial Narrow', arial, serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2;\"><span style=\"box-sizing: border-box; padding: 0px; margin: 0px; font-size: 14pt; font-family: 楷体_gb2312;\">base=`basename $file`</span></div><div style=\"box-sizing: border-box; margin: 0cm 0cm 0pt; padding: 0px; color: rgb(85, 85, 85); font-family: 宋体, 'Arial Narrow', arial, serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2;\"><span style=\"box-sizing: border-box; padding: 0px; margin: 0px; font-size: 14pt; font-family: 楷体_gb2312;\">NextNum=`expr $NextNum + 1`</span></div><div style=\"box-sizing: border-box; margin: 0cm 0cm 0pt; padding: 0px; color: rgb(85, 85, 85); font-family: 宋体, 'Arial Narrow', arial, serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2;\"><span style=\"box-sizing: border-box; padding: 0px; margin: 0px; font-size: 14pt; font-family: 楷体_gb2312;\">if [ $NextNum -eq $COUNTER ]</span></div><div style=\"box-sizing: border-box; margin: 0cm 0cm 0pt; padding: 0px; color: rgb(85, 85, 85); font-family: 宋体, 'Arial Narrow', arial, serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2;\"><span style=\"box-sizing: border-box; padding: 0px; margin: 0px; font-size: 14pt; font-family: 楷体_gb2312;\">then</span></div><div style=\"box-sizing: border-box; margin: 0cm 0cm 0pt; padding: 0px; color: rgb(85, 85, 85); font-family: 宋体, 'Arial Narrow', arial, serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2;\"><span style=\"box-sizing: border-box; padding: 0px; margin: 0px; font-size: 14pt; font-family: 楷体_gb2312;\">echo \"skip lastest\"</span></div><div style=\"box-sizing: border-box; margin: 0cm 0cm 0pt; padding: 0px; color: rgb(85, 85, 85); font-family: 宋体, 'Arial Narrow', arial, serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2;\"><span style=\"box-sizing: border-box; padding: 0px; margin: 0px; font-size: 14pt; font-family: 楷体_gb2312;\">else</span></div><div style=\"box-sizing: border-box; margin: 0cm 0cm 0pt; padding: 0px; color: rgb(85, 85, 85); font-family: 宋体, 'Arial Narrow', arial, serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2;\"><span style=\"box-sizing: border-box; padding: 0px; margin: 0px; font-size: 14pt; font-family: 楷体_gb2312;\">dest=$BAKDIR/$base</span></div><div style=\"box-sizing: border-box; margin: 0cm 0cm 0pt; padding: 0px; color: rgb(85, 85, 85); font-family: 宋体, 'Arial Narrow', arial, serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2;\"><span style=\"box-sizing: border-box; padding: 0px; margin: 0px; font-size: 14pt; font-family: 楷体_gb2312;\">if(test -e $dest)</span></div><div style=\"box-sizing: border-box; margin: 0cm 0cm 0pt; padding: 0px; color: rgb(85, 85, 85); font-family: 宋体, 'Arial Narrow', arial, serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2;\"><span style=\"box-sizing: border-box; padding: 0px; margin: 0px; font-size: 14pt; font-family: 楷体_gb2312;\">then</span></div><div style=\"box-sizing: border-box; margin: 0cm 0cm 0pt; padding: 0px; color: rgb(85, 85, 85); font-family: 宋体, 'Arial Narrow', arial, serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2;\"><span style=\"box-sizing: border-box; padding: 0px; margin: 0px; font-size: 14pt; font-family: 楷体_gb2312;\">echo \"skip exist $base\"</span></div><div style=\"box-sizing: border-box; margin: 0cm 0cm 0pt; padding: 0px; color: rgb(85, 85, 85); font-family: 宋体, 'Arial Narrow', arial, serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2;\"><span style=\"box-sizing: border-box; padding: 0px; margin: 0px; font-size: 14pt; font-family: 楷体_gb2312;\">else</span></div><div style=\"box-sizing: border-box; margin: 0cm 0cm 0pt; padding: 0px; color: rgb(85, 85, 85); font-family: 宋体, 'Arial Narrow', arial, serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2;\"><span style=\"box-sizing: border-box; padding: 0px; margin: 0px; font-size: 14pt; font-family: 楷体_gb2312;\">echo \"copying $base\"</span></div><div style=\"box-sizing: border-box; margin: 0cm 0cm 0pt; padding: 0px; color: rgb(85, 85, 85); font-family: 宋体, 'Arial Narrow', arial, serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2;\"><span style=\"box-sizing: border-box; padding: 0px; margin: 0px; font-size: 14pt; font-family: 楷体_gb2312;\">cp $base $BAKDIR</span></div><div style=\"box-sizing: border-box; margin: 0cm 0cm 0pt; padding: 0px; color: rgb(85, 85, 85); font-family: 宋体, 'Arial Narrow', arial, serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2;\"><span style=\"box-sizing: border-box; padding: 0px; margin: 0px; font-size: 14pt; font-family: 楷体_gb2312;\">fi</span></div><div style=\"box-sizing: border-box; margin: 0cm 0cm 0pt; padding: 0px; color: rgb(85, 85, 85); font-family: 宋体, 'Arial Narrow', arial, serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2;\"><span style=\"box-sizing: border-box; padding: 0px; margin: 0px; font-size: 14pt; font-family: 楷体_gb2312;\">fi</span></div><div style=\"box-sizing: border-box; margin: 0cm 0cm 0pt; padding: 0px; color: rgb(85, 85, 85); font-family: 宋体, 'Arial Narrow', arial, serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2;\"><span style=\"box-sizing: border-box; padding: 0px; margin: 0px; font-size: 14pt; font-family: 楷体_gb2312;\">done</span></div><div style=\"box-sizing: border-box; margin: 0cm 0cm 0pt; padding: 0px; color: rgb(85, 85, 85); font-family: 宋体, 'Arial Narrow', arial, serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2;\"><span style=\"box-sizing: border-box; padding: 0px; margin: 0px; font-size: 14pt; font-family: 楷体_gb2312;\">&nbsp;</span></div><div style=\"box-sizing: border-box; margin: 0cm 0cm 0pt; padding: 0px; color: rgb(85, 85, 85); font-family: 宋体, 'Arial Narrow', arial, serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2;\"><span style=\"box-sizing: border-box; padding: 0px; margin: 0px; font-size: 14pt; font-family: 楷体_gb2312;\">echo \"backup mysql binlog ok\"</span></div><div style=\"box-sizing: border-box; margin: 0cm 0cm 0pt; padding: 0px; color: rgb(85, 85, 85); font-family: 宋体, 'Arial Narrow', arial, serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2; text-indent: 35pt;\"><span style=\"box-sizing: border-box; padding: 0px; margin: 0px; font-size: 14pt; font-family: 楷体_gb2312;\">增量备份脚本是备份前<span style=\"box-sizing: border-box; padding: 0px; margin: 0px;\">flush-logs,mysql</span>会自动把内存中的日志放到文件里<span style=\"box-sizing: border-box; padding: 0px; margin: 0px;\">,</span>然后生成一个新的日志文件<span style=\"box-sizing: border-box; padding: 0px; margin: 0px;\">,</span>所以我们只需要备份前面的几个即可<span style=\"box-sizing: border-box; padding: 0px; margin: 0px;\">,</span>也就是不备份最后一个<span style=\"box-sizing: border-box; padding: 0px; margin: 0px;\">.</span></span></div><div style=\"box-sizing: border-box; margin: 0cm 0cm 0pt; padding: 0px; color: rgb(85, 85, 85); font-family: 宋体, 'Arial Narrow', arial, serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2;\"><span style=\"box-sizing: border-box; padding: 0px; margin: 0px; font-size: 14pt; font-family: 楷体_gb2312;\">因为从上次备份到本次备份也可能会有多个日志文件生成<span style=\"box-sizing: border-box; padding: 0px; margin: 0px;\">,</span>所以要检测文件<span style=\"box-sizing: border-box; padding: 0px; margin: 0px;\">,</span>如果已经备份过<span style=\"box-sizing: border-box; padding: 0px; margin: 0px;\">,</span>就不用备份了<span style=\"box-sizing: border-box; padding: 0px; margin: 0px;\">.</span></span></div><div style=\"box-sizing: border-box; margin: 0cm 0cm 0pt; padding: 0px; color: rgb(85, 85, 85); font-family: 宋体, 'Arial Narrow', arial, serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2;\"><span style=\"box-sizing: border-box; padding: 0px; margin: 0px; font-size: 14pt; font-family: 楷体_gb2312;\">数据还原：</span></div><div style=\"box-sizing: border-box; margin: 0cm 0cm 0pt; padding: 0px; color: rgb(85, 85, 85); font-family: 宋体, 'Arial Narrow', arial, serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2;\"><span style=\"box-sizing: border-box; padding: 0px; margin: 0px; font-size: 14pt; font-family: 楷体_gb2312;\">先还原最近的完全备份数据：</span></div><div style=\"box-sizing: border-box; margin: 0cm 0cm 0pt; padding: 0px; color: rgb(85, 85, 85); font-family: 宋体, 'Arial Narrow', arial, serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2;\"><span style=\"box-sizing: border-box; padding: 0px; margin: 0px; font-size: 14pt; font-family: 楷体_gb2312;\">mysql -hhostname -uusername -ppassword databasename &lt; backupfile.sql</span></div><div style=\"box-sizing: border-box; margin: 0cm 0cm 0pt; padding: 0px; color: rgb(85, 85, 85); font-family: 宋体, 'Arial Narrow', arial, serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2;\"><span style=\"box-sizing: border-box; padding: 0px; margin: 0px; font-size: 14pt; font-family: 楷体_gb2312;\">&nbsp;</span></div><div style=\"box-sizing: border-box; margin: 0cm 0cm 0pt; padding: 0px; color: rgb(85, 85, 85); font-family: 宋体, 'Arial Narrow', arial, serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2;\"><span style=\"box-sizing: border-box; padding: 0px; margin: 0px; font-size: 14pt; font-family: 楷体_gb2312;\">再还原<span style=\"box-sizing: border-box; padding: 0px; margin: 0px;\">binlog</span></span><span style=\"box-sizing: border-box; padding: 0px; margin: 0px; font-size: 14pt;\">&nbsp;</span><span style=\"box-sizing: border-box; padding: 0px; margin: 0px; font-size: 14pt; font-family: 楷体_gb2312;\">：</span></div><div style=\"box-sizing: border-box; margin: 0cm 0cm 0pt; padding: 0px; color: rgb(85, 85, 85); font-family: 宋体, 'Arial Narrow', arial, serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2;\"><span style=\"box-sizing: border-box; padding: 0px; margin: 0px; font-size: 14pt; font-family: 楷体_gb2312;\">./mysqlbinlog --start-date=\"2009-04-10 17:30:05\" --stop-date=\"2009-04-10 17:41:28\" /usr/local/mysql/data/mysql-bin.000002 |mysql -u root -p123456</span></div>"
    }
  ]
}